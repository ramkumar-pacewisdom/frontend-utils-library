<form [formGroup]="myForm" [class]="classFlex" (focusout)="handleFocusOut($event)" [ngClass]="{'disabled-with-pointer-events': viewOnly}">
  <ng-container *ngFor="let control of formJson; let i = index" >
    <div [class]="control.cssStyle" style="position: relative;">
    <mat-form-field appearance="outline"
      *ngIf="control?.type === 'text' || control?.type === 'password'"
      floatLabel="always"
    >
      <mat-label *ngIf="control.label">{{ control?.label }}</mat-label>
      <input
        matInput
        [placeholder]="control?.placeHolder"
        [type]="control?.type"
        [formControlName]="control?.name"
        [maxlength]="control?.validators.maxLength"
        [required]="control?.validators?.required"
        [value]="control?.value"
        [(ngModel)]="control.value"
        [readonly]="viewOnly"
        [id]="control?.name"
      />
      <mat-icon
        matSuffix
        *ngIf="control?.type === 'password' || control?.showPasswordIcon"
        (click)="togglePasswordVisibility(control)"
        style="cursor: pointer"
      >
        {{ control?.type === "password" ? "visibility_off" : "visibility" }}
      </mat-icon>
    </mat-form-field>
    <mat-form-field appearance="outline"
      *ngIf="control?.type === 'number'"
      floatLabel="always"
    >
      <mat-label *ngIf="control.label">{{ control?.label }}</mat-label>
      <input
        matInput
        [placeholder]="control?.placeHolder"
        [type]="control?.type"
        [formControlName]="control?.name"
        [min]="control?.validators.min"
        [max]="control?.validators.max"
        [required]="control?.validators?.required"
        [value]="control?.value"
        [(ngModel)]="control.value"
        [readonly]="viewOnly"
      />
      <mat-icon
        matSuffix
        *ngIf="control?.type === 'password' || control?.showPasswordIcon"
        (click)="togglePasswordVisibility(control)"
        style="cursor: pointer"
      >
        {{ control?.type === "password" ? "visibility_off" : "visibility" }}
      </mat-icon>
    </mat-form-field>

    <mat-form-field appearance="outline" *ngIf="control?.type === 'textarea'" floatLabel="always" >
      <mat-label *ngIf="control.label">{{ control?.label }}</mat-label>
      <textarea
        matInput
        [formControlName]="control?.name"
        [placeholder]="control?.placeHolder"
        [maxlength]="control?.validators?.maxLength"
        [required]="control?.validators?.required"
        [value]="control?.value"
        [(ngModel)]="control.value"
        [readonly]="viewOnly"
        [id]="control?.name"
      >
      </textarea>
    </mat-form-field>

    <mat-form-field appearance="outline" *ngIf="control?.type === 'select'" floatLabel="always">
      <mat-label *ngIf="control.label">{{ control?.label }}</mat-label>
      <mat-select
        [placeholder]="control?.placeHolder"
        [formControlName]="control?.name"
        [required]="control?.validators?.required"
        [compareWith]="compareWith"
        [multiple]="control.isMultiSelect"
      >
        <mat-option *ngFor="let option of control?.options" [value]="option" [selected]="control.value == option.value">
          {{ option.label }}
        </mat-option>
      </mat-select>
    </mat-form-field>

    <mat-form-field appearance="outline" *ngIf="control?.type === 'chip'" floatLabel="always">
      <mat-label *ngIf="control.label">{{ control?.label }}</mat-label>
      <lib-chip-input
        [chipControl]="control"
        [formControlName]="control?.name"
        [viewOnly]="viewOnly"
        [id]="control?.name"
      ></lib-chip-input>
      <textarea
        matInput
        [formControlName]="control?.name"
        hidden
        class="visibility-hidden"
        [id]="control?.name"
        [required]="control?.validators?.required"
      ></textarea>
    </mat-form-field>

    <mat-form-field appearance="outline" *ngIf="control?.type === 'range'" floatLabel="always">
      <mat-label *ngIf="control.label">{{ control?.label }}</mat-label>
      <mat-slider
        style="width: 100%"
        [min]="control?.min"
        [max]="control?.max"
        [step]="control?.step"
        [discrete]="control?.showThumbLabel"
      >
      <input matSliderThumb [formControlName]="control?.name" [value]="control?.value">
      </mat-slider>
      <textarea matInput [formControlName]="control?.name" hidden></textarea>
    </mat-form-field>

    <mat-form-field appearance="outline" *ngIf="control?.type === 'rating'" floatLabel="always">
      <mat-label *ngIf="control.label">{{ control?.label }}</mat-label>
      <lib-star-rating
        [formControlName]="control.name"
        [label]="control.label"
        [starsCount]="control.noOfstars"
      ></lib-star-rating>
      <textarea matInput [formControlName]="control?.name" hidden></textarea>
    </mat-form-field>

    <mat-form-field appearance="outline" *ngIf="control?.type === 'checkbox'" floatLabel="always">
      <mat-label *ngIf="control.label">{{ control?.label }}</mat-label>
      <input matInput [formControlName]="control?.name" hidden />
      <lib-checkbox-input
        [checkboxControl]="control"
        [formControlName]="control?.name"
      ></lib-checkbox-input>
    </mat-form-field>

    <mat-form-field appearance="outline" *ngIf="control?.type === 'radio'" floatLabel="always">
      <mat-label *ngIf="control.label">{{ control?.label }}</mat-label>
      <input matInput [formControlName]="control?.name" hidden class="visibility-hidden" />
      <lib-radio-input
        [radioControl]="control"
        [formControlName]="control?.name"
      ></lib-radio-input>
    </mat-form-field>

    <mat-form-field appearance="outline" *ngIf="control?.type == 'toggle'" floatLabel="always">
      <mat-label *ngIf="control.label">{{ control?.label }}</mat-label>
      <mat-slide-toggle
        [formControlName]="control?.name"
        [checked]="control?.value"
        [required]="control?.validators?.required"
        color="primary"
        (change)="togglefield($event)"
      >
      </mat-slide-toggle>
      <textarea
        class="visibility-hidden"
        matInput
        [formControlName]="control?.name"
        hidden
        [required]="control?.validators?.required"
      ></textarea>
    </mat-form-field>

    <div *ngIf="control?.type == 'subFields'" >
      <div>
        <dynamic-form [formJson]="control.subfields" [viewOnly]="viewOnly" classFlex="flex-class" #subform (change)="addFields(control?.name, $event)" ></dynamic-form>
      </div>
    </div>

    <!-- <mat-form-field appearance="outline" *ngIf="control?.type == 'subFields'" floatLabel="always" hidden>
      <mat-label *ngIf="control.label">{{ control?.label }}</mat-label> -->
      <!-- <div> -->
        <!-- <dynamic-form [formJson]="control.subfields" classFlex="flex-class" #subform (change)="addFields(control?.name, $event)" ></dynamic-form> -->
      <!-- </div> -->
      <!-- <textarea
        matInput
        [formControlName]="control?.name"
        hidden
        style="visibility: hidden;"
        [required]="control?.validators?.required || this.subform?.myForm?.invalid"
      ></textarea>
    </mat-form-field> -->

    <mat-form-field *ngIf="control?.type == 'addResource'" floatLabel="always" class="no-bottom-line">
      <mat-label *ngIf="control.label">{{ control?.label }}</mat-label>
      <div class="resource-button cursor-pointer" (click)="onClickAddResource(control)">
        <mat-icon>{{control.icon}}</mat-icon>&nbsp;
        <p>{{control?.textForLink}}</p>
      </div>
      <div class="flex flex-col gap-4">
        <div  *ngFor="let resource of resources;let i = index" class="resource-items-container">
          <section class="resouce-inner-section">
            <img src="assets/images/video-icon.png" alt="My Image">&nbsp;
            <p>{{resource.name}}</p>
          </section>
          <mat-icon (click)="deleteResource(i,control?.name)" class="cursor-pointer">close</mat-icon>
        </div>
      </div>
      <textarea
        matInput
        [formControlName]="control?.name"
        hidden
        [required]="control?.validators?.required"
        [readonly]="viewOnly"
      ></textarea>
    </mat-form-field>

    <mat-form-field class="example-full-width"  appearance="outline" floatLabel="always"  *ngIf="control?.type == 'date'">
      <mat-label *ngIf="control.label">{{ control?.label }}</mat-label>
      <input matInput [placeholder]="control?.placeHolder" (click)="picker.open()" [formControlName]="control?.name" readonly [matDatepicker]="picker">
      <mat-datepicker-toggle matIconSuffix [for]="picker"></mat-datepicker-toggle>
      <mat-datepicker #picker></mat-datepicker>
    </mat-form-field>

    <mat-form-field *ngIf="control?.type == 'triggerParent'" floatLabel="always" class="no-bottom-line">
      <mat-label *ngIf="control.label">{{ control?.label }}</mat-label>
      <div class="resource-button cursor-pointer" (click)="navigateToParent(control)">
        <mat-icon>{{control.icon}}</mat-icon>&nbsp;
        <p>{{control?.textForLink}}</p>
      </div>
      <input matInput [formControlName]="control?.name" hidden class="visibility-hidden"  [required]="control?.validators?.required"/>
    </mat-form-field>

    <mat-icon
      *ngIf="control?.infoMessage"
      class="info-icon enable-with-pointer-events"
      matTooltipClass="info-tooltip"
      matTooltipPosition="above"
      [matTooltip]="control?.infoMessage"
      [matTooltipDisabled]="true"
      #tooltip="matTooltip"
      (click)="showTooltip(i)"
      (mouseleave)="hideTooltip(i)">info
    </mat-icon>

  <mat-error class="error-container" *ngIf="control?.errorMessage">
    <div  *ngIf="
    myForm.get(control?.name)?.touched &&
    myForm.get(control?.name)?.invalid" >
  <div
  class="error-message"
  *ngIf="
    control?.errorMessage[
      ((myForm.get(control.name)?.errors | keyvalue) || [])[0].key
    ];
    else genericErrorMessage
  "
>
  <mat-icon class="error-icon" matPrefix>error_outline</mat-icon>
  {{
    control?.errorMessage[
      ((myForm.get(control.name)?.errors | keyvalue) || [])[0].key
    ]
  }}
</div>
<ng-template #genericErrorMessage>
  <div class="error-message">
    <mat-icon class="error-icon" matPrefix>error_outline</mat-icon>
    Enter {{ control?.label }}
  </div>
</ng-template>
    </div>
</mat-error>
</div>
</ng-container>
</form>